# Perfil específico para Unisimon Aula Pregrado (Moodle)
metadata:
  name: "Moodle Unisimon"
  version: "1.0.0"
  description: "Perfil para aulapregrado.unisimon.edu.co"
  lms_type: "moodle"

auth:
  login_path: "/login/"
  form_selectors:
    username: "#username"
    password: "#password"
    submit: "#loginbtn"
  success_indicators:
    - url_contains: "/my/"
    - element_present: "[data-region='courses-view']"
  error_indicators:
    - element_present: ".loginerrors"

navigation:
  courses_page: "/my/courses.php"
  dashboard: "/my/"

# Vista de paneles/tarjetas en /my/courses.php (Moodle 4 block_myoverview)
# Estructura: data-region="courses-view" -> card-deck -> course-content por tarjeta
# course_link_segments: palabras que identifican un enlace a curso si aparecen en algún segmento
# del path de la URL (comparación case-insensitive). La extracción por segmento se intenta primero.
# Selectores genéricos: card_selectors, name_selectors, link_selector, link_href_pattern,
# fallback_containers y more_navigation son opcionales; si no se definen se usan defaults Moodle.
courses:
  course_link_segments:
    - "course"
    - "courses"
    - "cursos"
  container: "[data-region='courses-view']"
  # Selectores Playwright para enlaces a curso (orden: más específico primero)
  selectors:
    - "div.card.course-card a[href*='course/view.php']"
    - "[data-region='course-content'] a[href*='course/view.php']"
    - "[data-region='course-content'] a.aalink.coursename"
    - ".course-card a[href*='course/view.php']"
    - ".card-grid a[href*='course/view.php']"
    - "a[href*='course/view.php']"
  # Tarjetas de curso (BS4 y detect_courses_presence); por defecto Moodle
  card_selectors:
    - "[data-region='course-content']"
    - "div.card.course-card"
  # Dentro de cada tarjeta: nombre del curso
  name_selectors:
    - "a.coursename"
    - "span.multiline"
    - "[title]"
  # Enlace al curso dentro de la tarjeta
  link_selector: "a[href*='course/view.php']"
  link_href_pattern: "course/view"
  # Si no hay tarjetas, buscar enlaces en estos contenedores
  fallback_containers:
    - "[data-region='courses-view']"
    - ".card-deck"
    - ".course-box"
  # Opcional: "Ver más" / paginación antes de extraer
  more_navigation:
    selectors: []  # ej.: "button:has-text('Ver más')", "a:has-text('Siguiente')"
    expand_before_extract: false
    max_clicks: 0
  extract:
    name: "text"
    url: "href"

# Discovery por contenido: si no se encuentran cursos, visitar enlaces y clasificar con LLM
course_discovery:
  fallback_when_empty: true
  max_candidates: 25
  candidate_patterns:
    - "course/view.php"
    - "/course/"

assignments:
  types:
    - name: "assignment"
      selectors:
        - "a[href*='mod/assign']"
        - ".activity-assign a"
        - ".modtype_assign a"
    - name: "quiz"
      selectors:
        - "a[href*='mod/quiz']"
        - ".activity-quiz a"
    - name: "forum"
      selectors:
        - "a[href*='mod/forum']"
        - ".activity-forum a"
    - name: "workshop"
      selectors:
        - "a[href*='mod/workshop']"

dates:
  locale: "es"
  formats:
    - "%d/%m/%Y"
    - "%d-%m-%Y"
    - "%d de %B de %Y"
  selectors:
    - ".due-date"
    - ".deadline"
    - ".activity-dates"
  patterns:
    - "vencimiento.*?(\\d{1,2}[/-]\\d{1,2}[/-]\\d{2,4})"
    - "entrega.*?(\\d{1,2}[/-]\\d{1,2}[/-]\\d{2,4})"
    - "(\\d{1,2} de \\w+ de \\d{4})"

submission:
  status_table: "table.generaltable"
  indicators:
    submitted:
      - "enviado para calificar"
      - "submitted for grading"
      - "entregado"
    pending:
      - "no entregado"
      - "not submitted"
      - "pendiente"

sections:
  tab_selectors:
    - ".nav-tabs a"
    - ".course-tabs a"
    - "a[href*='section']"
  max_tabs: 5

reports:
  title_template: "Reporte de Tareas - Unisimon"
  sections:
    - name: "submitted"
      title: "Tareas Entregadas Recientemente"
      emoji: "rocket"
    - name: "overdue"
      title: "Tareas Atrasadas"
      emoji: "warning"
    - name: "due_today"
      title: "Tareas para Hoy"
      emoji: "calendar"
    - name: "upcoming"
      title: "Próximas Tareas"
      emoji: "clock"
